<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>世紀輪廻メモリア</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-b from-purple-100 via-pink-100 to-yellow-100 min-h-screen flex flex-col items-center">

<header class="w-full bg-white shadow-md py-6 mb-6 rounded-b-3xl text-center">
  <h1 class="text-4xl font-extrabold text-purple-700">🕰 世紀輪廻メモリア</h1>
</header>

<main class="flex-1 w-full max-w-3xl px-4">
  <div id="gameArea" class="bg-white rounded-3xl shadow-lg p-6 flex flex-col items-center">
    <div id="text" class="text-gray-800 text-lg mb-6 text-center">ゲームスタートを押して物語を進めよう！</div>
    <div id="choices" class="flex flex-col gap-4 w-full items-center"></div>
    <button id="startBtn" class="mt-4 bg-purple-500 hover:bg-purple-600 text-white font-bold px-6 py-3 rounded-2xl">ゲーム開始 ▶</button>
  </div>
</main>

<script>
// ゲーム状態
const GameState = {
  currentScene: 0,
  route: null,
  inRoute: false,
  affection: { Miku:0, Shizuka:0, Rena:0 },
  flags: {},
  BellShard:0
};

// 共通ルートサンプル
const commonScenes = [
  {text:"第1章：転入と三つの扉。誰の隣？", choices:[
    {label:"未来", affect:{Miku:1}, flag:"F_Miku_Help", next:"common2"},
    {label:"静", affect:{Shizuka:1}, flag:"F_Library_Key", next:"common2"},
    {label:"玲奈", affect:{Rena:1}, flag:"F_Council_Pass", next:"common2"}
  ]},
  {key:"common2", text:"放課後どの活動に参加？", choices:[
    {label:"未来の部誌手伝い", affect:{Miku:2}, flag:"F_Miku_Help", next:"common3"},
    {label:"図書室で静の整理", affect:{Shizuka:2}, flag:"F_Library_Key", next:"common3"},
    {label:"生徒会の資料運び", affect:{Rena:2}, flag:"F_Council_Pass", next:"common3"}
  ]},
  {key:"common3", text:"夜、夢で零時の鐘の断片を見た。", choices:[
    {label:"次へ", next:"common4"}],
    BellShard:1
  },
  {key:"common4", text:"前夜祭に誰と回る？", choices:[
    {label:"未来", affect:{Miku:2}, next:"common5"},
    {label:"静", affect:{Shizuka:2}, next:"common5"},
    {label:"玲奈", affect:{Rena:2}, next:"common5"}
  ]},
  {key:"common5", text:"校舎裏で無音の鐘の幻聴。", choices:[{label:"次へ", next:null}], BellShard:1}
];

// 個別ルートサンプル（未来のみ）
const MikuRoute = [
  {text:"雨宿りの屋上。未来の口癖「きっと大丈夫」が聞こえる", choices:[{label:"次へ", next:"Miku2"}], flag:"F_Rooftop_Promise"},
  {key:"Miku2", text:"写真部の暗室で二重写りの写真を発見", choices:[
    {label:"真実を掘る", flag:"F_Photo_Truth", next:"Miku3"},
    {label:"今を守る", flag:"F_Photo_Love", next:"Miku3"}
  ], BellShard:1},
  {key:"Miku3", text:"星祭の告白。鐘が鳴る寸前。", choices:[
    {label:"Good: 今を選ぶ", next:null},
    {label:"Bitter: 真実を追う", next:null},
    {label:"Bad: 儀礼阻害", next:null}
  ]}
];

// 現在表示中のシーン
let currentScenes = commonScenes;

// シーン表示関数
function showScene(){
  const scene = currentScenes[GameState.currentScene];
  document.getElementById("text").innerHTML = scene.text;

  // BellShard増加
  if(scene.BellShard) GameState.BellShard += scene.BellShard;

  // 選択肢生成
  const choicesDiv = document.getElementById("choices");
  choicesDiv.innerHTML = "";
  scene.choices.forEach(choice=>{
    const btn = document.createElement("button");
    btn.textContent = choice.label;
    btn.className="bg-blue-500 hover:bg-blue-600 text-white font-bold px-4 py-2 rounded-2xl w-64";
    btn.onclick = ()=>{
      // Affection
      if(choice.affect){
        for(const c in choice.affect) GameState.affection[c] += choice.affect[c];
      }
      if(choice.flag) GameState.flags[choice.flag]=true;

      // ルート遷移判定（例：BellShardが一定なら未来ルート）
      if(choice.next === null){
        // 選択肢終了後の個別ルート判定
        const maxAff = Math.max(GameState.affection.Miku, GameState.affection.Shizuka, GameState.affection.Rena);
        if(maxAff === GameState.affection.Miku){
          currentScenes = MikuRoute;
          GameState.inRoute = true;
          GameState.route = "Miku";
          GameState.currentScene = 0;
          showScene();
          return;
        } else {
          document.getElementById("text").innerHTML = "物語はここで終了です。";
          choicesDiv.innerHTML = "";
          return;
        }
      }

      // 次のシーンに進む
      const nextKey = choice.next;
      const nextIndex = currentScenes.findIndex(s=>s.key===nextKey);
      if(nextIndex>=0){
        GameState.currentScene = nextIndex;
      } else {
        GameState.currentScene++;
      }
      showScene();
    };
    choicesDiv.appendChild(btn);
  });
}

// ゲームスタートボタン
document.getElementById("startBtn").addEventListener("click", ()=>{
  document.getElementById("startBtn").style.display="none";
  showScene();
});

</script>
</body>
</html>
